# =============================================================================
# PostgreSQL 커스텀 설정 (2GB 컨테이너 최적화)
# 기본값과 동일한 설정은 제거함. 상세 설명은 README.md 참조
# =============================================================================

# -----------------------------------------------------------------------------
# 접속 및 네트워크
# -----------------------------------------------------------------------------

# Docker 컨테이너 외부 접속 허용 (기본값 localhost)
listen_addresses = '*'

# -----------------------------------------------------------------------------
# 메모리 설정 (2GB 컨테이너 기준)
# -----------------------------------------------------------------------------

# 주 데이터/인덱스 캐시 (RAM의 25%)
# 기본값 128MB → 2GB 컨테이너에서 512MB로 증가
shared_buffers = 512MB

# 쿼리 플래너 힌트: OS 캐시 포함 전체 가용 메모리 추정값 (RAM의 75%)
# 기본값 4GB → 2GB 컨테이너 기준으로 조정 (실제 메모리 할당 아님)
effective_cache_size = 1536MB

# VACUUM, CREATE INDEX, REINDEX 등 유지보수 작업용 메모리
# 기본값 64MB → 2GB 컨테이너에서 128MB로 증가
maintenance_work_mem = 128MB

# -----------------------------------------------------------------------------
# 파일 및 I/O
# -----------------------------------------------------------------------------

# SSD 환경에서 비동기 I/O 동시성 설정 (기본값 1)
effective_io_concurrency = 200

# -----------------------------------------------------------------------------
# 확장 모듈
# -----------------------------------------------------------------------------

# pg_stat_statements: 쿼리 성능 모니터링 (init.sql에서 CREATE EXTENSION)
# pg_bigm: 한글/CJK 2-gram 검색 (init.sql에서 CREATE EXTENSION)
shared_preload_libraries = 'pg_stat_statements,pg_bigm'

# -----------------------------------------------------------------------------
# 모니터링
# -----------------------------------------------------------------------------

# I/O 타이밍 통계 수집 (기본값 off)
track_io_timing = on

# 함수 호출 통계 수집 (기본값 none)
track_functions = 'all'

# -----------------------------------------------------------------------------
# 로깅
# -----------------------------------------------------------------------------

# 100ms 이상 걸리는 쿼리를 로그에 기록 (기본값 -1 비활성)
log_min_duration_statement = 100

logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d '

# DDL 구문 로그 기록 (기본값 none)
log_statement = 'ddl'

# 임시 파일 생성 시 로그 기록 (기본값 -1 비활성, 0=모두 기록)
log_temp_files = 0

# -----------------------------------------------------------------------------
# Autovacuum (MVCC 정리 - PostgreSQL 필수)
# -----------------------------------------------------------------------------

# autovacuum 실행 주기 단축 (기본값 1min → 30s)
autovacuum_naptime = 30s

# vacuum 트리거 비율 (기본값 0.2 → 0.05: 테이블의 5% 변경 시 실행)
autovacuum_vacuum_scale_factor = 0.05

# analyze 트리거 비율 (기본값 0.1 → 0.025: 테이블의 2.5% 변경 시 실행)
autovacuum_analyze_scale_factor = 0.025
